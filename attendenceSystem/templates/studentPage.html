{% extends "layout.html" %}
{% block content %}
<!-- <div class="col-md-4">
    <div class="content-section">
        <h3>choose designation</h3>
        <ul class="list-group">
            <li class="list-group-item list-group-item-light">Coordinator login</li>
            <li class="list-group-item list-group-item-light">Student login</li>
        </ul>
        </p>
    </div>
</div> -->
<!-- {% for post in posts %}
<article class="media content-section">
    <div class="media-body">
        <div class="article-metadata">
            <a class="mr-2" href="#">{{ post.author }}</a>
            <small class="text-muted">{{ post.date_posted }}</small>
        </div>
        <h2><a class="article-title" href="#">{{ post.title }}</a></h2>
        <p class="article-content">{{ post.content }}</p>
    </div>
</article>
{% endfor %} -->




<div class="d-grid gap-2 col-6 mx-auto">

    <div id="video-container">
        <video id="video" autoplay></video>
        <button class="btn btn-primary bg-steel" type="button" id="start-button">Mark Attendence</button>
        <button class="btn btn-primary bg-steel" type="button" id="stop-button">Stop camera</button>
    </div>
    <button class="btn btn-primary bg-steel" id="matchButton">Match</button>
    <div id="result"></div>

</div>












<!-- <div class="d-grid gap-2 col-6 mx-auto">
    <button class="btn btn-primary bg-steel" type="button" onclick="">Mark Attendence</button>
</div> -->


<h3 class="mt-5">Previous Attendence :</h3>
<table class="table mt-2">
    <thead class="border-black border-2">
      <tr>
        <th scope="col">S.No.</th>
        <th scope="col">Date</th>
        <th scope="col">P/A</th>
      </tr>
    </thead>
    <tbody class="border-black border-2">
      <tr>
        <th scope="row">1</th>
        <td>18/10/23</td>
        <td>P</td>
      </tr>
      <!-- <tr>
        <th scope="row">2</th>
        <td>Jacob</td>
        <td>Thornton</td>
        <td>@fat</td>
      </tr>
      <tr>
        <th scope="row">3</th>
        <td colspan="2">Larry the Bird</td>
        <td>@twitter</td>
      </tr> -->
    </tbody>
  </table>


  <script>
    let videoStream;
    const video = document.getElementById('video');
    const startButton = document.getElementById('start-button');
    const stopButton = document.getElementById('stop-button');
    const matchButton = document.getElementById('matchButton');
    const resultDiv = document.getElementById('result');

    startButton.addEventListener('click', async () => {
        try {
            videoStream = await navigator.mediaDevices.getUserMedia({ video: true });
            video.srcObject = videoStream;
            startButton.disabled = true;
            stopButton.disabled = false;
        } catch (error) {
            console.error('Error accessing webcam:', error);
        }
    });

    stopButton.addEventListener('click', () => {
        if (videoStream) {
            videoStream.getTracks().forEach(track => track.stop());
            video.srcObject = null;
            startButton.disabled = false;
            stopButton.disabled = true;
        }
    });

    matchButton.addEventListener('click', () => {
        if (videoStream) {
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            context.drawImage(video, 0, 0, canvas.width, canvas.height);

            // Convert the captured frame to a Blob
            canvas.toBlob(blob => {
                const formData = new FormData();
                formData.append('frame', blob, 'frame.jpg');

                // Send the frame data to the server with the correct content type
                fetch('/process_frame', {
                    method: 'POST',
                    body: formData,
                })
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        resultDiv.innerHTML = `Error: ${data.error}`;
                    } else {
                        resultDiv.innerHTML = `Recognized Faces: ${data.recognized_faces}`;
                        // resultDiv.innerHTML = `Recognized Faces: ${data.recognized_faces.join(', ')}`;
                    }
                });
            }, 'image/jpeg');
        }
    });
</script>


{% endblock content %}